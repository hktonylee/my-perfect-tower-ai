:import [Library]

;;; ---------------------------------------------------------------------------
;;; Declarations
:global int _1
:local int fromDustTier

;;; ---------------------------------------------------------------------------
;;; Macros
#minLowerTierCount 1000.0
#minHigherTierCount 500.0
#maxMixerCount 500.0

;;; ---------------------------------------------------------------------------
;;; Actions
    fromDustTier = _1

    craft("lump", fromDustTier, \
        floor(double.min( \
            ({positive(count("dust", fromDustTier))} - {minLowerTierCount}) / 4.0, \
            {positive(count("dust", fromDustTier + 1) - {minHigherTierCount})} \
        )) \
    )

    ; If mixer is working, don't add more to it
    gotoif(END, active("mixer"))

    ; To mix the lump into higher tier dust
    produce("lump", fromDustTier, \
        double.min({maxMixerCount}, count("lump", fromDustTier)), \
        "mixer" \
    )

END:
